<!doctype html>
<html lang="en">

<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- Add this to <head> -->

<!-- Load polyfills to support older browsers -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver" crossorigin="anonymous"></script>

<!-- Load Vue followed by BootstrapVue -->
<script src="https://unpkg.com/vue@latest/dist/vue.min.js"></script>

<script src="https://unpkg.com/vue@2.6.10/dist/vue.js"></script>
<script src="https://unpkg.com/vue-select@latest"></script>


<script src="https://code.highcharts.com/highcharts.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/highcharts-vue@1.3.5/dist/highcharts-vue.min.js"></script>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>

<!-- datepicker-->
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue2-datepicker@1.9.7/dist/build.min.js"></script>
<script src="https://momentjs.com/downloads/moment.js"></script>

<style>
    body{
        padding:5em;   
    }
    video{
        margin: 20px;
    }

    #titulo{
        padding-top: 2em !important;
        padding-bottom: 1em;
        color: #333;
        font-weight: bolder;
        font-size: 25px;
        font-family:'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif}  
    .col{
        background-color: #eee;
        padding: 2px;
    }
    .col:hover{
        background-color: orange;
    }
    button {
    margin-top: 25px;
    background-color:rgb(168, 167, 167);
    color: #fff;
    border:none;
    font-size: 14px;
    font-style: normal;
    font-weight: 100;
    border-radius:5px;
    padding: 10px;
    }
    #url{
        color: #aaa;
        text-align: right;
        position:fixed;
        bottom: 3em;
        right: 3em;
        width: 20em;;
    }
</style>

</head>

<body>
  <div id="app2" >
   
    <div class="container ">
        <center>
        <div class="row">
            <h2 id="titulo">Splendid BeeCounter </h2>
            <div v-if="date">
                {{dateText}}
            </div>
            <date-picker  v-model="date" lang="en" ></date-picker>
                 
            <p>Mac: {{mac}}</p>

            
            </div>
            <div id="url">
                
                <div>
                    <p @click="setMac('00:00:00:00:00:00')"> [ A ] </p>
                    <p @click="setMac('d8:3a:dd:e4:9b:17')"> [ B ] </p>
                    <p @click="setMac('d8:3a:dd:f8:83:8d')"> [ C ] </p>
                   
              
               </div>

             </div>
          <div>
            <highcharts :options="chartOptions" ></highcharts>
          </div>

         <div>
            {{datosColmena}}
         </div>

        </div>
        </center>
    </div>


  
 </div>

    <script>
        Vue.use(HighchartsVue.default)
        Vue.component('v-select', VueSelect.VueSelect);

        Vue.use(DatePicker.default);


var app = new Vue({
    el: "#app2",
    mounted: function(){
       this.getData()
    },
    data() {
        return {
            setup:{
                "apiUrl": "http://titi.etsii.urjc.es:8010/",
                
            },
            date: new Date(),
            dateStr:"",
            mac: "d8:3a:dd:f8:83:8d",//"00:00:00:00:00:00", //"A8:42:E3:91:58:4C",
            datosColmena:{},
            chartOptions:{  
                            chart:{
                                height: 500,
                                zoomType:"x",
                                type: "area",
                                tooltip: {
                                    enabled: false
                                },
                                 animation: false,
                            },
                            title: {
                                text: 'Entradas y salidas'
                            },
                            xAxis:  {
                                type: 'datetime',
                                labels: {
                                    format: '{value:%H:%M}'
                                }
                            },
                            series: [
                                {
                                    data: [0,1,3,1,0],     
                                    fillColor: 'rgba(0,0,255,0.1)', 
                                    color: 'rgba(0,0,100,.5)',
                          
                                    name: 'In'
                                },
                                {
                                    data: [0,1,3,1,0],     
                                    fillColor: 'rgba(255,0,0,0.1)', 
                                    color: 'rgba(100,0,0,.5)',
                                    lineWidth:1,
                              
                                    name: 'Out'
                                },
                            ],
                           
                    }
           
        }
    },
    computed: {
        dateText () {
  
            var d = this.date
            var datestring = d.getFullYear() + "-" 
                +("0"+(parseInt(d.getMonth())+1)).slice(-2)
                + "-" + ("0" + d.getDate()).slice(-2); // 
                this.dateStr = datestring
            return datestring;
        }
    },
    methods:{
        getData(){
            var u = this.setup.apiUrl+"data/"+this.mac+"/"+this.dateStr
            
            const vm = this
            axios.get(u)
                .then(function(r){
                    vm.datosColmena =  
                        "In: "+String(r.data.inBees)+" Out:"+String(r.data.outBees)+" Lost:"+String(r.data.outBees-r.data.inBees)
                    vm.chartOptions.series[0].data = r.data.detailed.in
                    vm.chartOptions.series[1].data = r.data.detailed.out
                })
        },
        setUrl(u){
            this.setup.apiUrl=u;
            this.getData()
        },
        setMac(m){
            this.mac=m;
            this.getData()
        }
        
       
    }
})
    </script>


</body>

</html>