<!doctype html>
<html lang="en">

<head>

  <meta charset="UTF-8">
  
  <!-- Add this to <head> -->

<!-- Load required Bootstrap and BootstrapVue CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
<!-- Load polyfills to support older browsers -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver" crossorigin="anonymous"></script>

<!-- Load Vue followed by BootstrapVue -->
<script src="https://unpkg.com/vue@latest/dist/vue.min.js"></script>
<script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>

<!-- Load the following for BootstrapVueIcons support -->
<script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue-icons.min.js"></script>

<script src="https://unpkg.com/vue@2.6.10/dist/vue.js"></script>
<script src="https://unpkg.com/vue-select@latest"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/highcharts-vue@1.3.5/dist/highcharts-vue.min.js"></script>


  <style>
        body{
            margin:auto;
            max-width: 800px;
        }
      #titulo{
        margin-top: 5em;
      } 

      #botones{
        margin-top: 5em;
        /*background-color: yellow;*/
        height: 8em;
      }
      .escape{
        font-size: 3em;
        background-color: #ccc;
        font-weight: bolder;
        padding: .75em;
        margin: .25em;
        color: white;
        border-radius: .2em;
        box-shadow: 4px 4px 9px #555;
      }
      .selected{
        background-color: orangered !important;
      }

      
    
    #numBees{
        position: fixed;
        top:2em;
        right: 2em;
        font-size: 100px;
        font-weight: bold;
    }
    #graficas{
        overflow: scroll;
    }
  </style>

</head>

<body>
  <div id="app2">
   <div id = "titulo">
    <center>
        <b >Splendid BeeCounter.</b>
        <p>Four escapes validation</p>
    </center>
   </div>
        
    <div>
       
       <center>
            <div id="botones">
            <span 
                class="escape" 
                :class={selected:index==ms}
                v-for="see, index in seeTunel"
                @click="change(index)">{{see}} </span>
            </div>
            
       </center>
       
    </div>
    <!----  -->
    <div id="graficas" v-for="escape, index in escapes.slice().reverse()">
       
      <div>
         <b>BEES: {{escape.total}}</b>
            <highcharts :options="getChart(escape)" ></highcharts> 
      </div>
    </div>

  

   
    </div>
       
        <!--<button @click="muestrear">5000 muestras</button> -->
        <br>


        <!--
        <div>   
            <img src="https://github.com/atauri/splendidBC/blob/main/add/licencia.png?raw=true" width="150">
        <p></p> 
        -->
    </div>

    <script>
        Vue.use(HighchartsVue.default)
        Vue.component('v-select', VueSelect.VueSelect);
 
var app = new Vue({
    el: "#app2",
    mounted: function(){
        
            this.connection = new WebSocket('ws://192.168.1.133:9000/');

            const vm = this  
            this.connection.onmessage = (event) => {    
                // llega un mensaje
    
                try {
                   var js = JSON.parse(event.data)
                   //vm.buffer=event.data 
                   console.log(js)
                   this.escapes.push(js)
                   vm.totalÂ += js.total
                  
                } catch (error) {
                    console.log(error)
                }
            }
            this.connection.onclose = function(e) {  
                }
            this.connection.onerror = (event) => {
                console.log(event)
            }    
    },
    data() {
        return {
            seeTunel:[0, 1, 2, 3],
            connection: null,
            ms:"0",
            total:0,
            escapes:[]
                         
        }
    },
    
    methods:{
        change(x){

            this.ms=x
            //this.seeTunel[parseInt(x)] = !this.seeTunel[parseInt(x)]
            //this.ms=this.seeTunel[parseInt(x)]
            //alert(x)
            this.muestrear(x)
        },

        getChart(escape){
            return{  
                            chart:{
                                zoomType:"x",
                                //type: "area",
                                height:"400",
                                tooltip: {
                                    enabled: false
                                },
                                 animation: false,
                            },
                            title: {
                                text: ''
                            },
                            yAxis: {
                                max: 1,
                                min:0
                            },
                           
                            series: [
                            
                            {
                                data: escape.peaks,     
                                color: "#000000",
                                lineWidth:1,
                                name: 'Bees',
                                    marker: {
                                        enabled: false
                                    },
                                    threshold: null
                            },
                            {
                                data: escape.interior,     
                                color: "#ff5555",
                                lineWidth:1,
                                name: 'Smoothed',
                                    marker: {
                                        enabled: false
                                    },
                                    threshold: null
                            },
                            {
                                data: escape.exterior,     
                                color: "#55aa55",
                                lineWidth:1,
                                visible: false, //defalut
                                name: 'Signal',
                                    marker: {
                                        enabled: false
                                    },
                                    threshold: null
                            },
                            ],
                           
                    }
        },
        matar(){
            //alert("parar")
            this.connection.send("x")
            
        },
        muestrear(x){
            this.escapes=[]
            this.connection.send(x)
        }
    },
})
    </script>


</body>

</html>